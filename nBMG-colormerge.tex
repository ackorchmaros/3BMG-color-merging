\documentclass[final,3p,times]{elsarticle}
\usepackage{amsmath, amssymb, amsfonts, amsfonts, amsthm,latexsym}
\DeclareSymbolFont{yhlargesymbols}{OMX}{yhex}{m}{n}
\DeclareMathAccent{\overarc}{\mathord}{yhlargesymbols}{"F3}
\usepackage[mathscr]{euscript}
\usepackage[noend]{algorithmic}
\usepackage{comment}
\usepackage{algorithm}
\renewcommand{\algorithmiccomment}[1]{\hfill$\rhd$\textit{#1}}
\usepackage{graphics}
\usepackage{enumerate}
\usepackage{enumitem}
\usepackage[usenames]{color}
\usepackage{mathtools}
\usepackage[normalem]{ulem}
\usepackage{import}
\usepackage{comment}
\usepackage{wrapfig}
\usepackage{optidef}
\usepackage{epsfig}
\usepackage{tikz-cd}
\usepackage{color}
\DeclareMathOperator{\Tr}{Tr}
% Plots
\usepackage{graphicx}
\usepackage{float}
\usepackage[font=scriptsize,labelfont=bf]{caption}
\usepackage{subcaption}
\usepackage{url}
\usepackage{tikz}
\usetikzlibrary{positioning,chains,fit,shapes,calc}
\usepackage[all]{xy}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}%[section]
\newtheorem{lemma}[theorem]{Lemma}%[section]
\newtheorem{question}{Question}
\newtheorem{definition}{Definition}[section]
\newtheorem{fact}{Observation}[section]
\newtheorem{example}{Example}[section]
\newtheorem{corollary}[theorem]{Corollary}%[section]
\newtheorem{corollary*}{Corollary}%[section]
\newtheorem{remark}[theorem]{Remark}%[section]
\newtheorem{problem}{Problem}[section]
\newtheorem{observ}{Observation}

\newcommand{\TODO}[1]{\begingroup\color{red}#1\endgroup}
\def\TODOO#1{\marginpar{\tiny\raggedright\color{red}#1}}

\newcommand{\ak}[1]{\begingroup\color{orange}#1\endgroup}
\newcommand{\OLD}[1]{\begingroup\tiny\color{gray}#1\endgroup}
\newcommand{\PFS}[1]{\begingroup\color{magenta}#1\endgroup}
\newcommand{\mh}[1]{\begingroup\color{blue}#1\endgroup}

%\journal{Discrete Applied Mathematics}
%\journal{Journal of Combinatorial Theory, Series B}

\DeclareMathOperator{\lca}{lca}

\begin{document}

\begin{frontmatter}
  \title{How merging colors characterizes 3-BMGs}

  \author[LEI]{Annachiara Korchmaros}
  \ead{annachiara@bioinf.uni-leipzig.de}

  \author[STOCK]{Marc Hellmuth}
  \ead{marc.hellmuth@math.su.se}

  \author[LEI,LEI-other,MIS,TBI,BOG,SFI]{Peter F. Stadler}
  \ead{stadler@bioinf.uni-leipzig.de}

\address[LEI]{Bioinformatics Group, Department of Computer Science \&
  Interdisciplinary Center for Bioinformatics, Universit{\"a}t Leipzig,
  H{\"a}rtelstra{\ss}e 16-18, D-04107 Leipzig, Germany}

\address[STOCK]{Department of Mathematics, Faculty of Science,
Stockholm University, SE-10691 Stockholm, Sweden}

\address[LEI-other]{German Centre for Integrative Biodiversity Research
  (iDiv) Halle-Jena-Leipzig, Competence Center for Scalable Data Services
  and Solutions Dresden-Leipzig, Leipzig Research Center for Civilization
  Diseases, and Centre for Biotechnology and Biomedicine at Leipzig
  University at Universit{\"a}t Leipzig}

\address[MIS]{Max Planck Institute for Mathematics in the Sciences,
  Inselstra{\ss}e 22, D-04103 Leipzig, Germany}

\address[TBI]{Institute for Theoretical Chemistry, University of Vienna,
  W{\"a}hringerstrasse 17, A-1090 Wien, Austria}

\address[BOG]{Facultad de Ciencias, Universidad National de Colombia, Sede
  Bogot{\'a}, Colombia}

\address[SFI]{Santa Fe Institute, 1399 Hyde Park Rd., Santa Fe NM 87501,
  USA}


\begin{abstract}
  
\end{abstract}


\begin{keyword}
 Colored directed graphs; rooted trees; phylogenetic
  combinatorics; best matches
\end{keyword}

\end{frontmatter}

\sloppy

\section{Introduction}

\section{Background}
\label{sec:background}
\subsection{Vertex-colored digraphs}


We consider \emph{directed graphs} $G=(V,E)$ with vertex set $V(G)\coloneqq V$
and edge set $E(G)\coloneqq E$ where $E\subseteq (V\times V)\setminus
\{(x,x)\mid x\in V\}$. Hence, by definition, $G$ does not contain loops or
multiple edges. We denote edges $e=(x,y)\in E$ simply by $xy$. 
An edge $xy\in E$ is \emph{symmetric} if $yx\in E$. 

For a vertex $x\in V$, the out-neighbors of $x$ in $G$
are those vertices $z\in V$ for which $xz\in E$, respectively. The 
out-neighborhood of $x$, i.e., the set of out-neighbors of $x$ is denoted by $N_G(x)$, or 
simply by $N(x)$ if there is no risk of confusion. 
A digraph $G$ is called sink-free if each of its vertices has at least one out-neighbor.

Let $S$ be a finite set of colors. A digraph $G=(V,E)$ is colored by the colors
in $S$, if there is a surjective map $\sigma: V\to S$ where $\sigma(x)$ is
called the \emph{color} of $x$. We use $(G,\sigma)$ to specify that $G$ is
equipped with such a map $\sigma$ and often say that $G$ is an $|S|$-colored
graphs to specify the number of colors used in $G$. A colored digraph $(G,
\sigma)$ is \emph{properly colored} or, equivalently, $\sigma$ is a \emph{proper
coloring} of $G$, if $\sigma(x)\neq \sigma(y)$ for all $xy\in E$. 

For every color $s\in S\setminus \{\sigma(x)\}$ we write $N(x,s)$ for the sets
of out-neighbors of $x$ with color $s$, respectively. We say that $(G,\sigma)$
is \emph{color-sink-free} if $N(x,s)\ne\emptyset$ for all $x\in V(G)$ and all
$s\in \sigma(V)\setminus\{\sigma(x)\}$.


\subsection{Rooted trees and triples, and leaf-colored trees} 
We consider rooted trees $T$. The root of $T$ is a distinguished vertex
$\rho_T\in V(T)$. For two vertices $x,y\in V(T)$, we write $y \preceq_{T} x$ if
$x$ lies on the unique path from the root to $y$, in which case $x$ is called an
\emph{ancestor} of $y$, and $y$ is called a \emph{descendant} of $x$. Note that
edges $e=xy\in E(T)$ imply that $y\preceq_T x$. In the latter case, $y$ is a
\emph{child} of $x$. Moreover, we say that $x$ and $y$ are \emph{comparable} if
$y\preceq_{T} x$ or $x\preceq_{T} y$ holds and, otherwise, $x$ and $y$ are
\emph{incomparable}. Note that $\preceq_{T}$ is a partial order with a unique
maximal element $\rho$. The \emph{leaves} $L=L(T)\subseteq V(T)$ of $T$ are
precisely the $\preceq_{T}$-minimal elements.

From here on, we assume that the root $\rho_T$ as well as every non-leaf vertex
of a tree have always at least two children. 

For a set of leaves $A\subseteq L$, we write $\lca_T(A)$ for the the \emph{last
common ancestor} of $A$, i.e., the unique $\preceq_T$-minimal vertex in $V(T)$
such that $x\preceq \lca_T(A)$ for all $x\in A$. For simplicity, we write
$\lca_T(x,y)$ instead of $\lca_T(\{x,y\})$. 

A (rooted) triple is a binary rooted tree on three vertices.  We denote by
$xy|z$ the rooted triple $t$ with leaf set $\{x,y,z\}$ and
$\lca_t(x,y) \prec_T \lca_t (x,z) = \lca_t(y,z)$. A tree $T$ \emph{displays}
$xy| z$ if $\lca_T(x,y) \prec_T \lca_T (x,z) = \lca_T(y,z)$.  


Two rooted trees $T_1=(V_1,E_1)$ and $T_2=(V_2,E_2)$ are \emph{isomorphic}, if
there is a bijection $\varphi:V(T_1) \rightarrow V(T_2)$ such that
$\varphi(\rho_{T_1}) = \rho_{T_2}$ and, in addition, $xy\in E_1$ if and only if
$\varphi(x)\varphi(y)\in E_2$. 


We consider trees $(T,\sigma)$ that are equipped with a coloring if its leaves, 
i.e., a surjective map $\sigma: L(T)\to S$.  


\subsection{Best Match Graphs}

Given a leaf-colored rooted tree $(T,\sigma)$, a leaf $y\in L(T)$ is a
{\emph{best match of}} $x\in L(T)$, in symbols $x\rightarrow y$, if
${\lca_T}(x,y)\preceq {\lca_T}(x,y')$ for all $y'\in L$ with
$\sigma(y')=\sigma(y)$. The \emph{best match graph} (\emph{BMG})
$\mathcal{G}(T,\sigma)$ associated to $(T,\sigma)$ is the digraph with vertex
set $L$ where the edges are the ordered pairs $xy$ with $x\rightarrow y$ and
$x\neq y$. A colored digraph $(G, \sigma)$ is a \emph{BMG}, whenever there is a
tree $(T,\sigma)$ such that $(G, \sigma) = \mathcal{G}(T,\sigma)$. In this case,
$(T,\sigma)$ \emph{explains} $(G, \sigma)$. 
    


\begin{definition}
Let $(G,\sigma)$ be a vertex-colored digraph. Then the set of
  \emph{informative triples} is
  \begin{align*}
    \mathscr{R}(G,\sigma) \coloneqq \big\{&    ab|b' \colon
    \sigma(a)\neq\sigma(b)=\sigma(b'),\,    ab\in E(G), \text{ and }
    ab'\notin E(G) \big\},
    \intertext{and the set of \emph{forbidden triples} is}
    \mathscr{F}(G,\sigma) \coloneqq \big\{
    &ab|b' \colon
    \sigma(a)\neq\sigma(b)=\sigma(b'),\,
    b\ne b',\, \text{ and }
    ab,ab'\in E(G) \big\}.
  \end{align*}
\end{definition}

\begin{proposition}[\cite{Schaller:21b}, Prop.~3.4 and Thm.~3.5]
  \label{prop:BMG-triple-charac}
  A properly colored graph $(G,\sigma)$ is a BMG if and only if (i) it is
  color-sink-free and (ii) $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$
  is consistent. 
  
  In particular, a leaf-colored tree $(T , \sigma)$  explains $(G, \sigma )$ 
  if and only if $(T , \sigma)$ agrees with $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$. 
\end{proposition}

\section{Color Merging}
\label{sec:operators}


	
	

\begin{definition}
  Let $(G,\sigma)$ be an $n$-colored digraph with color-set $S$ and $\Pi =
  \{S_1,\dots,S_k\}$, $k\geq 1$ be a partition of $S$. Define the
  $k$-colored graph $(G_{\Pi},\sigma_{\Pi})$ with color map
  $\sigma_{\Pi}\colon V(G_{\Pi})\to \Pi$, as follows:
  \begin{enumerate}
  \item $V(G_{\Pi})\coloneqq V(G)$,
  \item $\sigma_{\Pi}(x)=S_i \iff \sigma(x)\in S_i\in\Pi$ 
  \item $xy\in E(G_{\Pi})$  if and only if $xy\in E(G)$ and 
    	  $\sigma_{\Pi}(x)\neq \sigma_{\Pi}(y)$. 
  \end{enumerate}
  We call $(G_{\Pi},\sigma_{\Pi})$ a \emph{partition-color-merged (PCM) graph of $(G,\sigma)$.}
  
\end{definition}	

Thus, $G_{\Pi}$ is obtained from $G$ by removing all edges between vertices $x$
and $y$ that are in a common class $S_i\in \Pi$. 
	

\mh{
Note that there are cases, where  $(G_{\Pi},\sigma_{\Pi})$ is not a BMG 
for all $\Pi$ with $|\Pi|>1$, for  BMGs $(G,\sigma)$. \TODO{fig}. 
Nevertheless, one may ask how much information about the property
``$(G,\sigma)$ is an  $n$-BMG'' is contained in certain
$\Pi$-color-mergeds graph of $(G,\sigma)$. 
}
\begin{definition}
\mh{
Let $(G,\sigma)$ be an $n$-colored digraph 
and $(G_{\Pi},\sigma_{\Pi})$ and $(G_{\Pi'},\sigma_{\Pi'})$ 
be two of its PCM graphs. 
Then, $(G,\sigma)$ satisfies the $(\Pi,\Pi')$-common-tree ($(\Pi,\Pi')$-cot) property
if 
\begin{enumerate}
	\item $(G_{\Pi},\sigma_{\Pi})$ is a BMG that is explained by $(T,\sigma_{\Pi})$.
	\item $(G_{\Pi'},\sigma_{\Pi'})$ is a BMG that is explained by $(T,\sigma_{\Pi'})$.
\end{enumerate}
}
\end{definition}

\TODO{MH: Is "cot" transitive? i.e., if $(G,\sigma)$ satisfies $(\Pi,\Pi')$-cot and $(\Pi',\Pi'')$-cot, then 
		$(G,\sigma)$ satisfies $(\Pi,\Pi'')$-cot ? In particular, if 
		$(G_{\Pi},\sigma_{\Pi})$  is explained by $(T,\sigma_{\Pi})$
		and $(G_{\Pi'},\sigma_{\Pi'})$ is explained by $(T,\sigma_{\Pi'})$
		can we the say that $(T,\sigma_{\Pi''})$ also explains 
		$(G_{\Pi''},\sigma_{\Pi''})$  -- I guess not, or??


If not transitive, we must talk about a collection of partitions $\Pi_1,\dots,\Pi_n$
such that all are explained by the same tree, i.e.,  there is a tree $T$ such
that each $(G_{\Pi_i},\sigma_{\Pi_i})$ is a BMG that is explained by $(T,\sigma_{\Pi_i})$
in order to get a generalization of 2/3-BMGs for which 
the partitions $\Pi = \{\{1\}, \{2,3\}\}$ and  $\Pi = \{\{2\}, \{1,3\}\}$ 
and $(\Pi,\Pi')$-cot is trivially sufficient to get all triples
in $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$ ... 
}	 
	 

%\begin{lemma}[transitivity]
%If $(G,\sigma)$ satisfies $(\Pi,\Pi')$-cot and $(\Pi',\Pi'')$-cot, then 
%$(G,\sigma)$ satisfies $(\Pi,\Pi'')$-cot. 
%\end{lemma}
%\begin{proof}
%Since $(G,\sigma)$ satisfies $(\Pi,\Pi')$-cot, there is a tree $T$ such
%that  $(T,\sigma_{\Pi})$ explains $(G_{\Pi},\sigma_{\Pi})$ and
%      $(T,\sigma_{\Pi'})$ explains $(G_{\Pi'},\sigma_{\Pi'})$. 
%In particular, $T , \sigma_{\Pi'})$ agrees with $(\mathscr{R}(G_{\Pi'},\sigma_{\Pi'}),\mathscr{F}(G_{\Pi'},\sigma_{\Pi'}))$
%and      

%Since $(G,\sigma)$ satisfies $(\Pi',\Pi'')$-cot, there is a tree $T'$ such
%that  $(T',\sigma_{\Pi'})$ explains $(G_{\Pi'},\sigma_{\Pi'})$ and
%      $(T',\sigma_{\Pi''})$ explains $(G_{\Pi''},\sigma_{\Pi''})$. 
%In particular, $(T', \sigma_{\Pi'})$ agrees with $(\mathscr{R}(G_{\Pi'},\sigma_{\Pi'}),\mathscr{F}(G_{\Pi'},\sigma_{\Pi'}))$

%      
%      
%  
%  {prop:BMG-triple-charac}
%  A properly colored graph $(G,\sigma)$ is a BMG if and only if (i) it is
%  color-sink-free and (ii) $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$
%  is consistent. 
%  
%  In particular, a leaf-colored tree $(T , \sigma)$  explains $(G, \sigma )$ 
%  if and only if $(T , \sigma)$ agrees with $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$.     
%      
%      
%      


%\end{proof}

%\begin{lemma}
%Let $(G,\sigma)$ be a properly $|S|$-colored digraph with $S =\{1,\dots,n\}$
%and assume that $(G,\sigma)$ is color-sink-free.
%Let $\Pi_1,\dots,\Pi_{n-1}$ be partitions of $S$ such that $\{\ell\}\in
%\Pi_\ell$ for all $\ell\in \{1,\dots, n-1$. Moreover, assume that $(G,\sigma)$
%satisfies the ($(\Pi,\Pi')$-cot) for all $i,j\in \in \{1,\dots, n-1\}$.
%Then, $(G,\sigma)$ is an $|S|$-BMG. 

%\TODO{MH:direct-translation-of-3colored-case  / but there are possibly other ways
%to generalize}
%\end{lemma}
%\begin{proof}
%By Prop.\ \ref{prop:BMG-triple-charac}, it suffices to show that 

%\end{proof}

\TODO{\smallskip
\begin{itemize}
\item what are necassary/sufficient conditions on $\Pi$ and $(G_{\Pi},\sigma_{\Pi})$
such that we get $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$ for color-sink free $(G,\sigma)$
? as this lies at the heart of all the 3BMG proofs as well. 

\item when is  $(G_{\Pi},\sigma_{\Pi})$ a $|\Pi|$-BMG?

\item what else .. ?

\end{itemize}
}

















\bibliographystyle{elsarticle-num}
\bibliography{references}

\end{document}















