\documentclass[final,3p,times]{elsarticle}
\usepackage{amsmath, amssymb, amsfonts, amsfonts, amsthm,latexsym}
\DeclareSymbolFont{yhlargesymbols}{OMX}{yhex}{m}{n}
\DeclareMathAccent{\overarc}{\mathord}{yhlargesymbols}{"F3}
\usepackage[mathscr]{euscript}
\usepackage[noend]{algorithmic}
\usepackage{comment}
\usepackage{algorithm}
\renewcommand{\algorithmiccomment}[1]{\hfill$\rhd$\textit{#1}}
\usepackage{graphics}
\usepackage{enumerate}
\usepackage{enumitem}
\usepackage[usenames]{color}
\usepackage{mathtools}
\usepackage[normalem]{ulem}
\usepackage{import}
\usepackage{comment}
\usepackage{wrapfig}
\usepackage{optidef}
\usepackage{epsfig}
\usepackage{tikz-cd}
\usepackage{color}
\DeclareMathOperator{\Tr}{Tr}
% Plots
\usepackage{graphicx}
\usepackage{float}
\usepackage[font=scriptsize,labelfont=bf]{caption}
\usepackage{subcaption}
\usepackage{url}
\usepackage{tikz}
\usetikzlibrary{positioning,chains,fit,shapes,calc}
\usepackage[all]{xy}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}%[section]
\newtheorem{lemma}[theorem]{Lemma}%[section]
\newtheorem{question}{Question}
\newtheorem{definition}{Definition}[section]
\newtheorem{fact}{Observation}[section]
\newtheorem{example}{Example}[section]
\newtheorem{corollary}[theorem]{Corollary}%[section]
\newtheorem{corollary*}{Corollary}%[section]
\newtheorem{remark}[theorem]{Remark}%[section]
\newtheorem{problem}{Problem}[section]
\newtheorem{observ}{Observation}

\newcommand{\TODO}[1]{\begingroup\color{red}#1\endgroup}
\def\TODOO#1{\marginpar{\tiny\raggedright\color{red}#1}}

\newcommand{\ak}[1]{\begingroup\color{orange}#1\endgroup}
\newcommand{\OLD}[1]{\begingroup\tiny\color{gray}#1\endgroup}
\newcommand{\PFS}[1]{\begingroup\color{magenta}#1\endgroup}
\newcommand{\mh}[1]{\begingroup\color{blue}#1\endgroup}

%\journal{Discrete Applied Mathematics}
%\journal{Journal of Combinatorial Theory, Series B}

\DeclareMathOperator{\lca}{lca}

\begin{document}

\begin{frontmatter}
  \title{How merging colors characterizes 3-BMGs}

  \author[LEI]{Annachiara Korchmaros}
  \ead{annachiara@bioinf.uni-leipzig.de}

  \author[STOCK]{Marc Hellmuth}
  \ead{marc.hellmuth@math.su.se}

  \author[LEI,LEI-other,MIS,TBI,BOG,SFI]{Peter F. Stadler}
  \ead{stadler@bioinf.uni-leipzig.de}

\address[LEI]{Bioinformatics Group, Department of Computer Science \&
  Interdisciplinary Center for Bioinformatics, Universit{\"a}t Leipzig,
  H{\"a}rtelstra{\ss}e 16-18, D-04107 Leipzig, Germany}

\address[STOCK]{Department of Mathematics, Faculty of Science,
Stockholm University, SE-10691 Stockholm, Sweden}

\address[LEI-other]{German Centre for Integrative Biodiversity Research
  (iDiv) Halle-Jena-Leipzig, Competence Center for Scalable Data Services
  and Solutions Dresden-Leipzig, Leipzig Research Center for Civilization
  Diseases, and Centre for Biotechnology and Biomedicine at Leipzig
  University at Universit{\"a}t Leipzig}

\address[MIS]{Max Planck Institute for Mathematics in the Sciences,
  Inselstra{\ss}e 22, D-04103 Leipzig, Germany}

\address[TBI]{Institute for Theoretical Chemistry, University of Vienna,
  W{\"a}hringerstrasse 17, A-1090 Wien, Austria}

\address[BOG]{Facultad de Ciencias, Universidad National de Colombia, Sede
  Bogot{\'a}, Colombia}

\address[SFI]{Santa Fe Institute, 1399 Hyde Park Rd., Santa Fe NM 87501,
  USA}


\begin{abstract}
  
\end{abstract}


\begin{keyword}
 Colored directed graphs; rooted trees; phylogenetic
  combinatorics; best matches
\end{keyword}

\end{frontmatter}

\sloppy

\section{Introduction}

\section{Background}
\label{sec:background}
\subsection{Vertex-colored digraphs}


We consider \emph{directed graphs} $G=(V,E)$ with vertex set $V(G)\coloneqq V$
and edge set $E(G)\coloneqq E$ where $E\subseteq (V\times V)\setminus
\{(x,x)\mid x\in V\}$. Hence, by definition, $G$ does not contain loops or
multiple edges. We denote edges $e=(x,y)\in E$ simply by $xy$. 
An edge $xy\in E$ is \emph{symmetric} if $yx\in E$. 

For a vertex $x\in V$, the out-neighbors of $x$ in $G$
are those vertices $z\in V$ for which $xz\in E$, respectively. The 
out-neighborhood of $x$, i.e., the set of out-neighbors of $x$ is denoted by $N_G(x)$, or 
simply by $N(x)$ if there is no risk of confusion. 
A digraph $G$ is called sink-free if each of its vertices has at least one out-neighbor.

Let $S$ be a finite set of colors. A digraph $G=(V,E)$ is colored by the colors
in $S$, if there is a surjective map $\sigma: V\to S$ where $\sigma(x)$ is
called the \emph{color} of $x$. We use $(G,\sigma)$ to specify that $G$ is
equipped with such a map $\sigma$ and often say that $G$ is an $|S|$-colored
graphs to specify the number of colors used in $G$. A colored digraph $(G,
\sigma)$ is \emph{properly colored} or, equivalently, $\sigma$ is a \emph{proper
coloring} of $G$, if $\sigma(x)\neq \sigma(y)$ for all $xy\in E$. 

For every color $s\in S\setminus \{\sigma(x)\}$ we write $N(x,s)$ for the sets
of out-neighbors of $x$ with color $s$, respectively. We say that $(G,\sigma)$
is \emph{color-sink-free} if $N(x,s)\ne\emptyset$ for all $x\in V(G)$ and all
$s\in \sigma(V)\setminus\{\sigma(x)\}$.


\subsection{Rooted trees and triples, and leaf-colored trees} 
We consider rooted trees $T$. The root of $T$ is a distinguished vertex
$\rho_T\in V(T)$. For two vertices $x,y\in V(T)$, we write $y \preceq_{T} x$ if
$x$ lies on the unique path from the root to $y$, in which case $x$ is called an
\emph{ancestor} of $y$, and $y$ is called a \emph{descendant} of $x$. Note that
edges $e=xy\in E(T)$ imply that $y\preceq_T x$. In the latter case, $y$ is a
\emph{child} of $x$. Moreover, we say that $x$ and $y$ are \emph{comparable} if
$y\preceq_{T} x$ or $x\preceq_{T} y$ holds and, otherwise, $x$ and $y$ are
\emph{incomparable}. Note that $\preceq_{T}$ is a partial order with a unique
maximal element $\rho$. The \emph{leaves} $L=L(T)\subseteq V(T)$ of $T$ are
precisely the $\preceq_{T}$-minimal elements.

From here on, we assume that the root $\rho_T$ as well as every non-leaf vertex
of a tree have always at least two children. 

For a set of leaves $A\subseteq L$, we write $\lca_T(A)$ for the the \emph{last
common ancestor} of $A$, i.e., the unique $\preceq_T$-minimal vertex in $V(T)$
such that $x\preceq \lca_T(A)$ for all $x\in A$. For simplicity, we write
$\lca_T(x,y)$ instead of $\lca_T(\{x,y\})$. 

A (rooted) triple is a binary rooted tree on three vertices.  We denote by
$xy|z$ the rooted triple $t$ with leaf set $\{x,y,z\}$ and
$\lca_t(x,y) \prec_T \lca_t (x,z) = \lca_t(y,z)$. A tree $T$ \emph{displays}
$xy| z$ if $\lca_T(x,y) \prec_T \lca_T (x,z) = \lca_T(y,z)$.  


Two rooted trees $T_1=(V_1,E_1)$ and $T_2=(V_2,E_2)$ are \emph{isomorphic}, if
there is a bijection $\varphi:V(T_1) \rightarrow V(T_2)$ such that
$\varphi(\rho_{T_1}) = \rho_{T_2}$ and, in addition, $xy\in E_1$ if and only if
$\varphi(x)\varphi(y)\in E_2$. 


We consider trees $(T,\sigma)$ that are equipped with a coloring if its leaves, 
i.e., a surjective map $\sigma: L(T)\to S$.  


\subsection{Best Match Graphs}

Given a leaf-colored rooted tree $(T,\sigma)$, a leaf $y\in L(T)$ is a
{\emph{best match of}} $x\in L(T)$, in symbols $x\rightarrow y$, if
${\lca_T}(x,y)\preceq {\lca_T}(x,y')$ for all $y'\in L$ with
$\sigma(y')=\sigma(y)$. The \emph{best match graph} (\emph{BMG})
$\mathcal{G}(T,\sigma)$ associated to $(T,\sigma)$ is the digraph with vertex
set $L$ where the edges are the ordered pairs $xy$ with $x\rightarrow y$ and
$x\neq y$. A colored digraph $(G, \sigma)$ is a \emph{BMG}, whenever there is a
tree $(T,\sigma)$ such that $(G, \sigma) = \mathcal{G}(T,\sigma)$. In this case,
$(T,\sigma)$ \emph{explains} $(G, \sigma)$. 
    


\begin{definition}
Let $(G,\sigma)$ be a vertex-colored digraph. Then the set of
  \emph{informative triples} is
  \begin{align*}
    \mathscr{R}(G,\sigma) \coloneqq \big\{&    ab|b' \colon
    \sigma(a)\neq\sigma(b)=\sigma(b'),\,    ab\in E(G), \text{ and }
    ab'\notin E(G) \big\},
    \intertext{and the set of \emph{forbidden triples} is}
    \mathscr{F}(G,\sigma) \coloneqq \big\{
    &ab|b' \colon
    \sigma(a)\neq\sigma(b)=\sigma(b'),\,
    b\ne b',\, \text{ and }
    ab,ab'\in E(G) \big\}.
  \end{align*}
\end{definition}

\begin{proposition}[\cite{Schaller:21b}, Prop.~3.4 and Thm.~3.5]
  \label{prop:BMG-triple-charac}
  A properly colored graph $(G,\sigma)$ is a BMG if and only if (i) it is
  color-sink-free and (ii) $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$
  is consistent. 
  
  In particular, a leaf-colored tree $(T , \sigma)$  explains $(G, \sigma )$ 
  if and only if $(T , \sigma)$ agrees with $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$. 
\end{proposition}

\section{Color Merging}
\label{sec:operators}


	
	

\begin{definition}
  Let $(G,\sigma)$ be an colored digraph with color-set $S$ and $\Pi =
  \{S_1,\dots,S_k\}$, $k\geq 1$ be a partition of $S$. Define the
  $k$-colored graph $(G_{\Pi},\sigma_{\Pi})$ with color map
  $\sigma_{\Pi}\colon V(G_{\Pi})\to \Pi$, as follows:
  \begin{enumerate}
  \item $V(G_{\Pi})\coloneqq V(G)$,
  \item $\sigma_{\Pi}(x)=S_i \iff \sigma(x)\in S_i\in\Pi$ 
  \item $xy\in E(G_{\Pi})$  if and only if $xy\in E(G)$ and 
    	  $\sigma_{\Pi}(x)\neq \sigma_{\Pi}(y)$. 
  \end{enumerate}
  We call $(G_{\Pi},\sigma_{\Pi})$ a \emph{partition-color-merged (PCM) graph of $(G,\sigma)$.}
\end{definition}	

Thus, $G_{\Pi}$ is obtained from $G$ by removing all edges between vertices $x$
and $y$ that are in a common class $S_i\in \Pi$. 
Note that there are cases, where  $(G_{\Pi},\sigma_{\Pi})$ is not a BMG 
for all $\Pi$ with $|\Pi|>1$ for  BMGs $(G,\sigma)$. \TODO{add fig for generic examples
that works for an arbirary number of colors. }
	

\TODO{ \begin{center}**** MH comment on old file **** \end{center} 
 To summarize the main-idea of the first part of annachiara: 
 \begin{itemize}[nolistsep, noitemsep]
 	\item it is assumed that $G$ is color-sinkfree and $|S|=3$
 	\item it is assumed that we have two partitions $\Pi_1 = \{\{1\},\{2,3\}\}$ and $\Pi_2=
		 \{\{2\},\{1,3\}\}$ such that 		 
		 $(G_{\Pi_1},\sigma_{\Pi_1})$ and $(G_{\Pi_2},\sigma_{\Pi_2})$ are 2-BMGs that
		 are explained by a common tree $T$. \smallskip
		 
		 This directly implies that
		 $(\mathscr{R}(G_{\Pi_i},\sigma_{\Pi_i}),\mathscr{F}(G_{\Pi_i},\sigma_{\Pi_i})$,
 		$i\in \{1,2\}$ are both consistent.		 \smallskip
 		
 		Since $(G_{\Pi_1},\sigma_{\Pi_1})$ and $(G_{\Pi_2},\sigma_{\Pi_2})$ are explained by common tree $T$, 
 		we immediately get that 
 		$(\mathscr{R}^*, \mathscr{F}^*) \coloneqq
 		  (\mathscr{R}(G_{\Pi_1},\sigma_{\Pi_1}),\mathscr{F}(G_{\Pi_1},\sigma_{\Pi_1})
 		  \cup (\mathscr{R}(G_{\Pi_2},\sigma_{\Pi_2}),\mathscr{F}(G_{\Pi_2},\sigma_{\Pi_2})$
 		  is consistent	
 	\item Since only $|S|=3$ colors are used, and one class of $\Pi_1$ and
 	      $\Pi_2$ consist of a single "outsourced color", it is almost a trivial
 	      and direct consequence that we can get ALL triples of
 	      $(\mathscr{R}(G,\sigma),(G,\sigma)$ of $G$ and that
 	      $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma)) \subseteq
 	      (\mathscr{R}^*, \mathscr{F}^*)$. 
 	      
  	      Since $(\mathscr{R}^*, \mathscr{F}^*)$ is consistent, 
 	      $(\mathscr{R}(G_{\Pi},\sigma_{\Pi}),\mathscr{F}(G_{\Pi},\sigma_{\Pi})$.
 	      is consistent. This together with $G$ is color-sinkfree implies that
 	      $G$ is a 3-BMG.  
  	  
 \end{itemize}
 
 \smallskip
 \noindent
  In other words, Annachiaras idea is essentially just a translation
 into "which triples in the 3-colored case (when mergin 2 colors) 
 does one get to obtain $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma)$". 
 So it is wrong to say, that this is a pure "graphtheoretic way"
 to describe/characterize 3-BMGS. \smallskip
 
 Note, in the general case, neither $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma)
 \subseteq (\mathscr{R}(G_{\Pi_i},\sigma_{\Pi_i}),\mathscr{F}(G_{\Pi_i},\sigma_{\Pi_i})$
 nor $ (\mathscr{R}(G_{\Pi_i},\sigma_{\Pi_i}),\mathscr{F}(G_{\Pi_i},\sigma_{\Pi_i})
 \subseteq (\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma)$
 holds (see lemma \ref{lem:R-Ri} below).\smallskip 
 
 Still I like the idea of "color-merging", but I think that these 
 strong conditions above + the fact that only $|S|=3$ colors are
  not enough for a publication. Hence, I try to generalize, 
 but still have some doubts, since everything is just a 
 "combinatorial" re-formulation of which triples do we get 
 from the $(\mathscr{R}(G_{\Pi},\sigma_{\Pi}),\mathscr{F}(G_{\Pi},\sigma_{\Pi})$
 (and we NEED to get all of $\mathscr{R}(G,\sigma)$ -- ie 
 $\mathscr{R}(G,\sigma)\subseteq \mathscr{R}(G_{\Pi},\sigma_{\Pi})$ must hold -- 
 and we ARE NOT ALLOWED to introduce further triples in 
 $\mathscr{F}(G_{\Pi},\sigma_{\Pi})$ -- ie
 $\mathscr{F}(G_{\Pi},\sigma_{\Pi}) \subseteq \mathscr{F}(G,\sigma)$ must hold --
 , which imposes
 extremely strong constraints on the different partitions $\Pi$
 we need (see Lemma \ref{lem:R-Ri}). 
\begin{center}**** --- **** \end{center}
}


\begin{lemma}\label{lem:basicsPCM}
  Let $(G,\sigma)$ be colored digraph and $(G_{\Pi},\sigma_{\Pi})$ 
  be a PCM of $G$. Then, $G_\Pi  \subseteq G$ and 
  $(G_{\Pi},\sigma_{\Pi})$ is properly colored. 
  Moreover, if $(G,\sigma)$ is color-sink-free, 
  then $(G_{\Pi},\sigma_{\Pi})$ is color-sink-free.
\end{lemma}
\begin{proof}
 	Let $(G,\sigma)$ be colored digraph and $(G_{\Pi},\sigma_{\Pi})$ 
  be a PCM of $G$. By construction, only edges that already
  exist in $G$ may be retained in $G_\Pi$ which together
  with $V(G) = V(G_\Pi)$ implies that $G_\Pi  \subseteq G$.
  Moreover, since all edges of $G$ that connect vertices 
  with the same color $\sigma_\Pi$ have been removed
  from $G$ to obtain $G_\Pi$, it follows that 
  $(G_{\Pi},\sigma_{\Pi})$ is properly colored. 
  
  Assume now that $(G,\sigma)$ is color-sink-free. 
  All vertices $z\in S_i\in \Pi$ obtain color
 $\sigma_\Pi(z)=S_i$. To show that $(G_\Pi,\sigma_\Pi)$ is color-sink-free we
	must show $N_{G_\Pi}(x,S_i)\neq \emptyset$ for all $S_i\in \Pi\setminus
	\{\sigma(x)\}$. The latter is equivalent to show that $N_{G_\Pi}(x,S_i)\neq
	\emptyset$ for all $S_i\in \Pi$ with $x\notin S_i$. Let $x\in V(G_\Pi)=V(G)$
	and suppose that $x\in S_j\in \Pi$ and thus, $\sigma_\Pi(x) = S_j$. Now,
	consider $S_i\in \Pi$ with $i\neq j$. By construction $\sigma(x)\neq
	\sigma(y)$ for all $y\in S_i$. Since $(G,\sigma)$ is color-sink-free, there
	is a vertex $y'\in S_i$ such that $\sigma(y')=\sigma(y)$ and $y'\in
	N_G(x,\sigma(y))$. In particular, $xy'$ remains an edge in $G_\Pi$. Hence,
	$N_{G_\Pi}(x,S_i)\neq \emptyset$. Since $S_i$ was chosen arbtrarily,
	$(G_\Pi,\sigma_\Pi)$ is color-sink-free.
 \end{proof}

Note that color-sink-freeness of  $(G_{\Pi},\sigma_{\Pi})$.
does, in general, not imply  color-sink-freeness of  $(G,\sigma)$.
To see this consider,  $(G,\sigma)$ with $V(G) = \{a,b,c\}$
and where the vertices have a pairwise distinct colors. 
Moreover, assume that $E(G) = \{ab,ba,ac,ca\}$. 
Since $b$ and $c$ are not adjacent in $G$ but have different
colors,  $(G,\sigma)$ is not color-sink-free. 
Now let $\Pi = \{\{\sigma(a)\},\{\sigma(b),\sigma(c)\}\}$
to obtain the color-sink-free graph $(G_{\Pi},\sigma_{\Pi})$.


\begin{lemma}\label{lem:R-Ri}
	Let $(G,\sigma)$ be a properly colored graph and $\Pi =  \{S_1,\dots,S_k\}$
	be a partition of the color set $S$. Then the following conditions hold. 
	
	\begin{enumerate}[nolistsep, noitemsep]
 		\item $\mathscr{R}(G,\sigma) \subseteq \mathscr{R}(G_\Pi,\sigma_\Pi)$
 			  	  if and only if 
	
			\begin{enumerate}[noitemsep]
 			  	 \item[(R1):]  for all $ab|b' \in \mathscr{R}(G,\sigma)$ we have 
 			  	 $\sigma_\Pi(a) \neq  \sigma_\Pi(b)$ 
			      i.e., $\sigma(a)$ and $\sigma_\Pi(b)$ are in different classes
			      of  $\Pi$. 	
			\end{enumerate}			      

 		\item $\mathscr{R}(G_\Pi,\sigma_\Pi)  \subseteq  \mathscr{R}(G,\sigma)$
 			  	  if and only if 			  	   
	
			\begin{enumerate}[noitemsep]
 			  	 \item[(R2):] for all $ab|b' \in \mathscr{R}(G_\Pi,\sigma_\Pi)$ we have 
 			  	 $\sigma(a) \neq \sigma(b) = \sigma(b')$. 
			\end{enumerate}			      
			      
 		\item $\mathscr{F}(G,\sigma) \subseteq \mathscr{F}(G_\Pi,\sigma_\Pi)$
 			  	  if and only if 
	
			\begin{enumerate}[noitemsep]
 			  	 \item[(F1):]  for all $ab|b' \in \mathscr{F}(G,\sigma)$ we have 
 			  	 $\sigma_\Pi(a) \neq  \sigma_\Pi(b)$ 
			      i.e., $\sigma(a)$ and $\sigma_\Pi(b)$ are in different classes
			      of  $\Pi$. 	
			\end{enumerate}			      

 		\item $\mathscr{F}(G_\Pi,\sigma_\Pi)  \subseteq  \mathscr{F}(G,\sigma)$
 			  	  if and only if 			  	   
	
			\begin{enumerate}[noitemsep]
 			  	 \item[(F2):] for all $ab|b' \in \mathscr{R}(G_\Pi,\sigma_\Pi)$ we have 
 			  	 $\sigma(a) \neq \sigma(b) = \sigma(b')$. 
			\end{enumerate}			      
	\end{enumerate}
	\TODO{[MH: note that (R1),  (R2),  (F1),  (F2) directlty translate to
	     "graphtheoretic properties" based on the (non)edges as used 
	     for the construction of $\mathscr{R}$ and $\mathscr{F}$. 
	     but its simpler for the statements to avoid these "edge-color-conditions".] }
\end{lemma}
\begin{proof}
	To simplify the writing we put $\mathscr{R}\coloneqq \mathscr{R}(G,\sigma)$, 
	$\mathscr{F}\coloneqq \mathscr{F}(G,\sigma)$, 
	$\mathscr{R}_\Pi\coloneqq \mathscr{R}(G_\Pi,\sigma_\Pi)$, and
	$\mathscr{F}_\Pi\coloneqq \mathscr{F}(G_\Pi,\sigma_\Pi)$. 

	\emph{(1): }
	By contraposition, assume that (R1) is not satisfied. Thus, there is a
	triple $ab|b' \in \mathscr{R}$ with $\sigma_\Pi(a) =
	\sigma_\Pi(b)$. Since (R1) is not satisfied, we have
	$\sigma_\Pi(b)=\sigma_\Pi(b')$ and thus,
	$\sigma_\Pi(a)=\sigma_\Pi(b)=\sigma_\Pi(b')$. Hence, $a|bb'\notin
	\mathscr{R}_\Pi$ and thus, $\mathscr{R}
	\not\subseteq \mathscr{R}_\Pi$. Hence, $\mathscr{R}
	\subseteq \mathscr{R}_\Pi$ implies (R1).
    
    Suppose (R1) holds. Let $ab|b' \in \mathscr{R}$. By definition,
    $\sigma(a)\neq\sigma(b)=\sigma(b')$, $ab\in E(G)$, and $ab'\notin E(G)$. By
    (R1), $\sigma_\Pi(a) \neq \sigma_\Pi(b)$ and, therefore, $ab\in E(G_\Pi)$.
    Moreover, by construction, it always holds $E(G_\Pi)\subseteq E(G)$ and
    thus, $ab'\notin E(G_\Pi)$. Hence, $a|bb'\in \mathscr{R}_\Pi$
    and we obtain $\mathscr{R}\subseteq
    \mathscr{R}_\Pi$. 
    
	\emph{(2):}
	By contraposition, assume that (R2) is not satisfied. 
	Let $ab|b' \in \mathscr{R}_\Pi$ and thus, 
	$\sigma_\Pi(a)\neq \sigma_\Pi(b) = \sigma_\Pi(b')$. 
	Since $\Pi$ ``merges'' colors, it follows that 
	$\sigma(a)\neq \sigma(b)$ and $\sigma(a)\neq \sigma(b')$. 
	This together with the
	assumption that (R2) is not satisfied implies
	that $\sigma(b) \neq \sigma(b')$. Hence, 
	$\sigma(a),  \sigma(b)$ and $\sigma(b')$ are pairwise
	distinct. Thus, $ab|b' \not\in \mathscr{R}$
	which shows that $\mathscr{R}_\Pi \not\subseteq  \mathscr{R}$. 
	Hence, $\mathscr{R}_\Pi \subseteq  \mathscr{R}$ implies (R2). 
	
	Suppose (R2) holds. Let $ab|b' \in \mathscr{R}_\Pi$
	and thus, $ab\in E(G_\Pi)$ and $ab'\notin E(G_\Pi)$
	as well as $\sigma_\Pi(a)\neq\sigma_\Pi(b)=\sigma_\Pi(b')$. 
	Since $E(G_\Pi)\subseteq E(G)$, we have $ab\in E(G)$. 
	By (R2), $\sigma(a)\neq\sigma(b) = \sigma(b')$.
	Since	$\sigma(a)\neq\sigma(b')$ and
	$ab'\notin E(G_\Pi)$ it holds, by construction of $G_\Pi$, 
	that $ab'\notin E(G)$. Hence, $ab|b' \in \mathscr{R}$
	and thus, $\mathscr{R}_\Pi \subseteq  \mathscr{R}$. 
	
	
	\TODO{proofs of (3) and (4) are nearly identical - if someone
	is bored, just add it ..}
\end{proof}

%\begin{lemma}
%	Let $(G,\sigma)$ be a colored graphs and $\Pi =  \{S_1,\dots,S_k\}$
%	be a partition of the color set $S$. 
%	Suppose that both $(G,\sigma)$  and  $(G_\Pi,\sigma_\Pi)$ are BMGs.
%	Then, the following statements are equivalent. 
%	\begin{enumerate}
%		\item $(G,\sigma)$ is explained by $(T,\sigma)$ and  $(G_\Pi,\sigma_\Pi)$ is explained 
%		   	 by $(T,\sigma_\Pi)$ (i.e, they share a common tree $T$)
%	
%		\item (R1), (R2), (F1) and (F2) are satisfied. 
%	\end{enumerate}
%\end{lemma}
%\begin{proof}
%	Assume that $(G,\sigma)$ is explained by $(T,\sigma)$ and  $(G_\Pi,\sigma_\Pi)$ is explained 
%	by $(T,\sigma_\Pi)$. 
%	
%\end{proof}

%\begin{lemma}
%Let $(G,\sigma)$ be a BMG and $(G_{\Pi},\sigma_{\Pi})$ be PCM graph of $(G,\sigma)$. 
%If $(G_{\Pi},\sigma_{\Pi})$ is color-sink-free
%and for all 

%, then $(G_{\Pi},\sigma_{\Pi})$ is a BMG. 
%\end{lemma}
%\begin{proof}
%Assume that $(G_{\Pi},\sigma_{\Pi})$ is color-sink-free. By Prop.\ \ref{prop:BMG-triple-charac}, 
%it suffices to show that $(\mathscr{R}(G_{\Pi},\sigma_{\Pi}),\mathscr{F}(G_{\Pi},\sigma_{\Pi})$ is consistent 
%to verify that  $(G_{\Pi},\sigma_{\Pi})$ is a BMG.

%Let $ab|b'\in \mathscr{R}(G_{\Pi}$. Hence, 
% $\sigma_{\Pi}(a)\neq\sigma_{\Pi}(b)=\sigma_{\Pi}(b')$ and $ab\in E(G)$ and 
%    $ab'\notin E(G)$.  mmh .. koennen haben $\sigma(b)\neq \sigma(b')$
%    and thus $ab|b'\notin \mathscr{R}(G)$ so, 
%    $\mathscr{R}(G_{\Pi}\not\subseteq \mathscr{R}(G)$
%\end{proof}


\begin{lemma}\label{BMG-R1F1}
    Let $(G,\sigma)$ be a properly colored graph that is  is color-sink-free. 
	Then, $(G,\sigma)$ is a BMG if and only if 
	there is a partition $\Pi$ of $S$ such that (R1) and (F1) is satisfied
	and $(\mathscr{R}(G_\Pi,\sigma_\Pi), \mathscr{F}(G_\Pi,\sigma_\Pi))$
	is consistent. In this case, $(G_\Pi,\sigma_\Pi)$ is a BMG. 
\end{lemma}
\begin{proof}
	Assume that $(G,\sigma)$ is a BMG. Let $\Pi$ be the partition that consists
	of $|S|$ color classes each consiting of a single color. Hence,
	$(G,\sigma)\simeq (G_\Pi,\sigma_\Pi)$. It is easy to verify that
	$\mathscr{R}(G,\sigma) = \mathscr{R}(G_\Pi,\sigma_\Pi)$ and
	$\mathscr{F}(G,\sigma) = \mathscr{F}(G_\Pi,\sigma_\Pi)$. By Lemma
	\ref{lem:R-Ri}, (R1) and (F1) are satisfied. Moreover, by Prop.\
	\ref{prop:BMG-triple-charac} and since $(G,\sigma)$ is a BMG,
	$(\mathscr{R}(G,\sigma), \mathscr{F}(G,\sigma)) =
	(\mathscr{R}(G_\Pi,\sigma_\Pi), \mathscr{F}(G_\Pi,\sigma_\Pi))$ is
	consistent.
	
	Now suppose that $(G,\sigma)$ is color-sink-free and that there is a
	partition $\Pi$ of $S$ such that $(\mathscr{R}(G_\Pi,\sigma_\Pi),
	\mathscr{F}(G_\Pi,\sigma_\Pi)$ is consistent and that (R1) and (F1) is
	satisfied. By Lemma \ref{lem:R-Ri}, $\mathscr{R}(G,\sigma) \subseteq
	\mathscr{R}(G_\Pi,\sigma_\Pi)$ and $\mathscr{F}(G,\sigma) \subseteq
	\mathscr{F}(G_\Pi,\sigma_\Pi)$. Hence, $(\mathscr{R}(G,\sigma)
	,\mathscr{F}(G,\sigma) $ is consistent. Now, we can apply Prop.\
	\ref{prop:BMG-triple-charac} to conclude that $(G,\sigma)$ is a BMG. 
	

	To see that $(G_\Pi,\sigma_\Pi)$ is a BMG, we observe first that Lemma
	\ref{lem:basicsPCM} implies that $(G_\Pi,\sigma_\Pi)$ is color-sink-free.
	Moreover, since $(\mathscr{R}(G_\Pi,\sigma_\Pi),
	\mathscr{F}(G_\Pi,\sigma_\Pi))$ is consistent, we can Prop.\
	\ref{prop:BMG-triple-charac} to conclude that $(G_\Pi,\sigma_\Pi)$ is a BMG.
\end{proof}


%\begin{lemma}
%Let $(G,\sigma)$ be a properly colored and color-sink-free graph. 
%Then there is is a partition $\Pi$ of $S$ such that 
% $(G_\Pi,\sigma_\Pi)$ is a BMG if and only if 
% (R2) and (F2) is satisfied
%  and $(\mathscr{R}(G,\sigma), \mathscr{F}(G,\sigma))$
%	is consistent. 
%	\TODO{(equivalent to ? $(G_\Pi,\sigma_\Pi)$ is a BMG and (R2,F2) ?? )}
%%	In this case, $(G_\Pi,\sigma_\Pi)$ is a BMG. 
%\end{lemma}
%\begin{proof}
%	For the \emph{if} direction, consistency of
%	$(\mathscr{R}(G,\sigma), \mathscr{F}(G,\sigma))$ and 
%	color-sink-freeness of the properly-colored graph $(G,\sigma)$ together
%	with Prop.\ \ref{prop:BMG-triple-charac} implies that 
%	$(G,\sigma)$ is a BMG. 
%	Now, we can choose the partition $\Pi$ that consists
%	of $|S|$ color classes each consiting of a single color. 
%	By the same arguments, as in the first part of the proof
%	of Lemma \ref{BMG-R1F1}, we can conclude that 
%	$(G_\Pi,\sigma_\Pi)$ is a BMG.
%	
%	Assume now that there is a partition $\Pi$ of $S$ such that 
%	$(G_\Pi,\sigma_\Pi)$ is a BMG. 
%\end{proof}


%\begin{lemma}\TODO{this is the interesting part:}
%	Let $(G,\sigma)$ be a properly colored and color-sink-free graph and $\Pi =  \{S_1,\dots,S_k\}$
%	be a partition of the color set $S$.
%	Then, 
%	 $(G_\Pi,\sigma_\Pi)$ is a BMG if and	only if
%	 \TODO{conditions that only depend on (R1/2) and (F1/2)--is this even possible?
%	 	(sufficient consitions are easily-derived, but necessary ones?)
%	 	}
%	 
%%	Moreover, $(G_\Pi,\sigma_\Pi)$ is a BMG if and
%%	only if (R2) and (F2) is satisfied and
%%	$(\mathscr{R}(G,\sigma), \mathscr{F}(G,\sigma)$ is consistent. 

%\end{lemma}

\TODO{MH- more interesting question: when is for a given partition $\Pi$ the graph $(G_\Pi,\sigma_\Pi)$ a BMG
where $(G,\sigma)$ properly colored and color-sink-free?
 }
 
\TODO{do we have a "generic" exmple such that  $(G_\Pi,\sigma_\Pi)$ is / is not a BMG
for all partitions $\Pi$ in case $(G,\sigma)$ is / is not BMG? } 


%Nevertheless, one may ask how much information about the property
%``$(G,\sigma)$ is an  $n$-BMG'' is contained in certain
%$\Pi$-color-mergeds graph of $(G,\sigma)$ and, contrary, which 
%$(G_{\Pi},\sigma_{\Pi})$ are BMGs. .. 













\TODO{\bigskip \bigskip NEXT refers to starting point in case we have several partitions .... }
\begin{definition}\TODO{translation of the 2nd-derivative stuff:}
\mh{
Let $(G,\sigma)$ be an $n$-colored digraph 
and $(G_{\Pi},\sigma_{\Pi})$ and $(G_{\Pi'},\sigma_{\Pi'})$ 
be two of its PCM graphs. 
Then, $(G,\sigma)$ satisfies the $(\Pi,\Pi')$-common-tree ($(\Pi,\Pi')$-cot) property
if 
\begin{enumerate}
	\item $(G_{\Pi},\sigma_{\Pi})$ is a BMG that is explained by $(T,\sigma_{\Pi})$.
	\item $(G_{\Pi'},\sigma_{\Pi'})$ is a BMG that is explained by $(T,\sigma_{\Pi'})$.
\end{enumerate}
}
\end{definition}

\TODO{MH: Is "cot" transitive? i.e., if $(G,\sigma)$ satisfies $(\Pi,\Pi')$-cot and $(\Pi',\Pi'')$-cot, then 
		$(G,\sigma)$ satisfies $(\Pi,\Pi'')$-cot ? In particular, 
		is there a common tree $T$ that together with the respective colorings explains, 
		$(G_{\Pi},\sigma_{\Pi})$ 
		and $(G_{\Pi'},\sigma_{\Pi'})$ and
		$(G_{\Pi''},\sigma_{\Pi''})$. I think, its possibly not transitive,  since
		there is not necessarily a tree that agrees with
		$$(\mathscr{R}(G_{\Pi},\sigma_{\Pi}),\mathscr{F}(G_{\Pi},\sigma_{\Pi}))\ \cup\ 
		(\mathscr{R}(G_{\Pi'},\sigma_{\Pi'}),\mathscr{F}(G_{\Pi'},\sigma_{\Pi'}))\ \cup\ 
		(\mathscr{R}(G_{\Pi''},\sigma_{\Pi''}),\mathscr{F}(G_{\Pi''},\sigma_{\Pi''}))$$
		


If not transitive, can we characterize when its transitive, so when 
does compatibilty of  $(\mathscr{R}(G_{\Pi},\sigma_{\Pi}),\mathscr{F}(G_{\Pi},\sigma_{\Pi}))\ \cup\ 
		(\mathscr{R}(G_{\Pi'},\sigma_{\Pi'}),\mathscr{F}(G_{\Pi'},\sigma_{\Pi'}))$
		and compatibilty of 
		and $
		(\mathscr{R}(G_{\Pi'},\sigma_{\Pi'}),\mathscr{F}(G_{\Pi'},\sigma_{\Pi'}))\ \cup\ 
		(\mathscr{R}(G_{\Pi''},\sigma_{\Pi''}),\mathscr{F}(G_{\Pi''},\sigma_{\Pi''}))$
		imply comptability of 
		$(\mathscr{R}(G_{\Pi},\sigma_{\Pi}),\mathscr{F}(G_{\Pi},\sigma_{\Pi}))\ \cup\ 
		(\mathscr{R}(G_{\Pi''},\sigma_{\Pi''}),\mathscr{F}(G_{\Pi''},\sigma_{\Pi''}))$?
		

if we dont come up with such a transitive result, 
we must talk about a collection of partitions $\Pi_1,\dots,\Pi_n$
such that all are explained by the same tree, i.e.,  there is a tree $T$ such
that each $(G_{\Pi_i},\sigma_{\Pi_i})$ is a BMG that is explained by $(T,\sigma_{\Pi_i})$
in order to get a generalization of 2/3-BMGs for which 
the partitions $\Pi = \{\{1\}, \{2,3\}\}$ and  $\Pi = \{\{2\}, \{1,3\}\}$ 
and $(\Pi,\Pi')$-cot is trivially sufficient to get all triples
in $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$ ... 
}	 
	 

%\begin{lemma}[transitivity]
%If $(G,\sigma)$ satisfies $(\Pi,\Pi')$-cot and $(\Pi',\Pi'')$-cot, then 
%$(G,\sigma)$ satisfies $(\Pi,\Pi'')$-cot. 
%\end{lemma}
%\begin{proof}
%Since $(G,\sigma)$ satisfies $(\Pi,\Pi')$-cot, there is a tree $T$ such
%that  $(T,\sigma_{\Pi})$ explains $(G_{\Pi},\sigma_{\Pi})$ and
%      $(T,\sigma_{\Pi'})$ explains $(G_{\Pi'},\sigma_{\Pi'})$. 
%In particular, $T , \sigma_{\Pi'})$ agrees with $(\mathscr{R}(G_{\Pi'},\sigma_{\Pi'}),\mathscr{F}(G_{\Pi'},\sigma_{\Pi'}))$
%and      

%Since $(G,\sigma)$ satisfies $(\Pi',\Pi'')$-cot, there is a tree $T'$ such
%that  $(T',\sigma_{\Pi'})$ explains $(G_{\Pi'},\sigma_{\Pi'})$ and
%      $(T',\sigma_{\Pi''})$ explains $(G_{\Pi''},\sigma_{\Pi''})$. 
%In particular, $(T', \sigma_{\Pi'})$ agrees with $(\mathscr{R}(G_{\Pi'},\sigma_{\Pi'}),\mathscr{F}(G_{\Pi'},\sigma_{\Pi'}))$

%      
%      
%  
%  {prop:BMG-triple-charac}
%  A properly colored graph $(G,\sigma)$ is a BMG if and only if (i) it is
%  color-sink-free and (ii) $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$
%  is consistent. 
%  
%  In particular, a leaf-colored tree $(T , \sigma)$  explains $(G, \sigma )$ 
%  if and only if $(T , \sigma)$ agrees with $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$.     
%      
%      
%      


%\end{proof}

%\begin{lemma}
%Let $(G,\sigma)$ be a properly $|S|$-colored digraph with $S =\{1,\dots,n\}$
%and assume that $(G,\sigma)$ is color-sink-free.
%Let $\Pi_1,\dots,\Pi_{n-1}$ be partitions of $S$ such that $\{\ell\}\in
%\Pi_\ell$ for all $\ell\in \{1,\dots, n-1$. Moreover, assume that $(G,\sigma)$
%satisfies the ($(\Pi,\Pi')$-cot) for all $i,j\in \in \{1,\dots, n-1\}$.
%Then, $(G,\sigma)$ is an $|S|$-BMG. 

%\TODO{MH:direct-translation-of-3colored-case  / but there are possibly other ways
%to generalize}
%\end{lemma}
%\begin{proof}
%By Prop.\ \ref{prop:BMG-triple-charac}, it suffices to show that 

%\end{proof}

\TODO{\smallskip
\begin{itemize}
\item what are necassary/sufficient conditions on $\Pi$ and $(G_{\Pi},\sigma_{\Pi})$
such that we get $(\mathscr{R}(G,\sigma),\mathscr{F}(G,\sigma))$ for color-sink free $(G,\sigma)$
? as this lies at the heart of all the 3BMG proofs as well. 

\item when is  $(G_{\Pi},\sigma_{\Pi})$ a $|\Pi|$-BMG?

\item what else .. ?

\end{itemize}
}

















\bibliographystyle{elsarticle-num}
\bibliography{references}

\end{document}















